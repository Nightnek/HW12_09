# 12_09 Стасенко Григорий Домашнее задание к занятию «Базы данных в облаке»

## Задание
### Создание кластера
Перейдите на главную страницу сервиса Managed Service for PostgreSQL.
Создайте кластер PostgreSQL со следующими параметрами:
класс хоста: s2.micro, диск network-ssd любого размера;
хосты: нужно создать два хоста в двух разных зонах доступности и указать необходимость публичного доступа, то есть публичного IP адреса, для них;
установите учётную запись для пользователя и базы.
Остальные параметры оставьте по умолчанию либо измените по своему усмотрению.

Нажмите кнопку «Создать кластер» и дождитесь окончания процесса создания, статус кластера = RUNNING. Кластер создаётся от 5 до 10 минут.

![image](https://github.com/Nightnek/HW12_09/assets/127677631/bb2efc83-4682-4f9f-90c3-569fff511df5)
![image](https://github.com/Nightnek/HW12_09/assets/127677631/b30630e9-0a11-49d4-b74c-8de0226ae9b9)


### Подключение к мастеру и реплике
Используйте инструкцию по подключению к кластеру, доступную на вкладке «Обзор»: cкачайте SSL-сертификат и подключитесь к кластеру с помощью утилиты psql, указав hostname всех узлов и атрибут target_session_attrs=read-write.

Проверьте, что подключение прошло к master-узлу.

select case when pg_is_in_recovery() then 'REPLICA' else 'MASTER' end;
![image](https://github.com/Nightnek/HW12_09/assets/127677631/fafaa338-8ea7-4485-b070-1f67d9b99592)


Посмотрите количество подключенных реплик:
select count(*) from pg_stat_replication;
![image](https://github.com/Nightnek/HW12_09/assets/127677631/5cdfe00a-212b-481f-8c31-44079fa133aa)


### Проверьте работоспособность репликации в кластере
Создайте таблицу и вставьте одну-две строки.
CREATE TABLE test_table(text varchar);
insert into test_table values('Строка 1');
Выйдите из psql командой \q.

Теперь подключитесь к узлу-реплике. Для этого из команды подключения удалите атрибут target_session_attrs и в параметре атрибут host передайте только имя хоста-реплики. Роли хостов можно посмотреть на соответствующей вкладке UI консоли.

Проверьте, что подключение прошло к узлу-реплике.

select case when pg_is_in_recovery() then 'REPLICA' else 'MASTER' end;
Проверьте состояние репликации
select status from pg_stat_wal_receiver;
Для проверки, что механизм репликации данных работает между зонами доступности облака, выполните запрос к таблице, созданной на предыдущем шаге:
select * from test_table;
В качестве результата вашей работы пришлите скриншоты:

1) Созданной базы данных; 2) Результата вывода команды на реплике select * from test_table;.
![image](https://github.com/Nightnek/HW12_09/assets/127677631/ae3061c5-1d7b-4ddd-9f89-83d896686cf7)

